# wc_server
Water Counter server )

ESP32 собирет показания со счетчиков воды и автоматически отправляет их в МОСОБЛЕИРЦ
Мониторинг и управление процессом осуществляется через телеграм бот.

Функции
- Считает импульсы от приборов учета оснащенных герконом
- Счетчики хранятся во внутреннем Flash (библиотека Preferences)
- Подключается к одной из доступных WiFi сетей (библиотека WiFiMulti)
- Оснащен telegram ботом (библитека FastBot)
- Подключается к сайту mosoblerc.ru и забирает оттуда текущие данные о ваших счетчиках
    - id приборов
    - ранее переданные показания
    - дата плановой поверки
    - даты когда можно подавать показания
- Время синхронизирует по NTP
- В нужный день месяца отправляет показания в мособлеирц
- Не передает показания если значения превысили месячный лимит
- За три месяца до срока поверки начинает слать напоминания
- начальные значения счетчиков выставляются через telegram

# Подготовка
Чтобы настроить программу, нужно отредактировать файл wc_server.ino
Все строки которые там нужно отредактировать помечены фразой //Edit me

```
const char* ssid1              = "ssid1";                        // Edit me
const char* ssid2              = "ssid2";                        // Edit me
const char* password           = "wifi_password";                // Edit me
const char* ntpServer1         = "ntp3.vniiftri.ru";
const char* ntpServer2         = "time.nist.gov";
const long  gmtOffset_sec      = 10800;
const int   daylightOffset_sec = 0;

#define BOT_TOKEN "your:bot_token"                               // Edit me
#define CHAT_ID "yourchatid"                                     // Edit me

FastBot bot(BOT_TOKEN);

#define HOT_PIN 23
#define COL_PIN 18

#define HOT_ID  1111111                                              // Edit me
#define COL_ID  2222222                                              // Edit me
```
Здесь вам нужно настроить ssid своих сетей и пароль от них. У меня на обоих ssid одинаковаый пароль. Если у вас не так, то отредактируйте еще и функции в которой инициализируется wifi

Зарегистрируйте своего telegram бота и узнайте id. Как это делается? в сети масса материалов.

